function f=interp4_l(x_g,y_g,z_g,q_g,V,x0,y0,z0,q0,xi,yi,zi,qi)
%performs for the vectors of length N the 3d interpolation of function V on
%grids x_g,y_g,z_g at function values x0,y0,z0, and lower grid indexes xi, yi, zi

num = ((x_g(xi+1)-x_g(xi)).*(y_g(yi+1)-y_g(yi)).*(z_g(zi+1)-z_g(zi)).*(q_g(qi+1)-q_g(qi)));
a0000 = ((x_g(xi+1)-x0).*(y_g(yi+1)-y0).*(z_g(zi+1)-z0).*(q_g(qi+1)-q0))./num;
a0001 = ((x_g(xi+1)-x0).*(y_g(yi+1)-y0).*(z_g(zi+1)-z0).*(q0-q_g(qi)))./num;
a0010 = ((x_g(xi+1)-x0).*(y_g(yi+1)-y0).*(z0-z_g(zi)).*(q_g(qi+1)-q0))./num;
a0011 = ((x_g(xi+1)-x0).*(y_g(yi+1)-y0).*(z0-z_g(zi)).*(q0-q_g(qi)))./num;
a0100 = ((x_g(xi+1)-x0).*(y0-y_g(yi)).*(z_g(zi+1)-z0).*(q_g(qi+1)-q0))./num;
a0101 = ((x_g(xi+1)-x0).*(y0-y_g(yi)).*(z_g(zi+1)-z0).*(q0-q_g(qi)))./num;
a0110 = ((x_g(xi+1)-x0).*(y0-y_g(yi)).*(z0-z_g(zi)).*(q_g(qi+1)-q0))./num;
a0111 = ((x_g(xi+1)-x0).*(y0-y_g(yi)).*(z0-z_g(zi)).*(q0-q_g(qi)))./num;
a1000 = ((x0-x_g(xi)).*(y_g(yi+1)-y0).*(z_g(zi+1)-z0).*(q_g(qi+1)-q0))./num;
a1001 = ((x0-x_g(xi)).*(y_g(yi+1)-y0).*(z_g(zi+1)-z0).*(q0-q_g(qi)))./num;
a1010 = ((x0-x_g(xi)).*(y_g(yi+1)-y0).*(z0-z_g(zi)).*(q_g(qi+1)-q0))./num;
a1011 = ((x0-x_g(xi)).*(y_g(yi+1)-y0).*(z0-z_g(zi)).*(q0-q_g(qi)))./num;
a1100 = ((x0-x_g(xi)).*(y0-y_g(yi)).*(z_g(zi+1)-z0).*(q_g(qi+1)-q0))./num;
a1101 = ((x0-x_g(xi)).*(y0-y_g(yi)).*(z_g(zi+1)-z0).*(q0-q_g(qi)))./num;
a1110 = ((x0-x_g(xi)).*(y0-y_g(yi)).*(z0-z_g(zi)).*(q_g(qi+1)-q0))./num;
a1111 = ((x0-x_g(xi)).*(y0-y_g(yi)).*(z0-z_g(zi)).*(q0-q_g(qi)))./num;


f = a0000*V(xi,yi,zi,qi)...
    +a0001*V(xi,yi,zi,qi+1)...
    +a0010*V(xi,yi,zi+1,qi)...
    +a0011*V(xi,yi,zi+1,qi+1)...
    +a0100*V(xi,yi+1,zi,qi)...
    +a0101*V(xi,yi+1,zi,qi+1)...
    +a0110*V(xi,yi+1,zi+1,qi)...
    +a0111*V(xi,yi+1,zi+1,qi+1)...
    +a1000*V(xi+1,yi,zi,qi)...
    +a1001*V(xi+1,yi,zi,qi+1)...
    +a1010*V(xi+1,yi,zi+1,qi)...
    +a1011*V(xi+1,yi,zi+1,qi+1)...
    +a1100*V(xi+1,yi+1,zi,qi)...
    +a1101*V(xi+1,yi+1,zi,qi+1)...
    +a1110*V(xi+1,yi+1,zi+1,qi)...
    +a1111*V(xi+1,yi+1,zi+1,qi+1);
